/* 
 * jquery WISHLIST 1.3 - Frogmouth 
 * https://github.com/Frogmouth/jQuery.Wishlist/
*/
!function(a){return window.wishList={length:0},"undefined"==typeof _||"undefined"==typeof Backbone?wishlist=!1:(a.fn.wishItem=function(b,c){var d=this,e=this.settings=a.extend({removeClass:"removeToWish",addClass:"addToWish",triggerClass:"wishAction",sameButton:!0,triggerEvent:"click",picker:null},b);return this.picker="function"==typeof e.pickerOverride?e.picker:function(a){var b=c.settings.useStorage?a.data():{id:a.data("id")};return toConsole("i data presi",b),b},this.changeAdd=function(){try{if(that.wishList.length<1)return!1;that.wishList.each(function(b){a("[data-id="+b.id+"]").removeClass("addToWish").addClass("removeToWish")})}catch(b){return!1}},unsetAttHandler=function(){d.addClass("wishDisabled"),d.on("click",function(){console.log("COOKIE DISABLED")})},e.useStorage?(localStorage.wishlist={},setHandler=!0):setHandler=navigator.cookieEnabled?!0:!1,setHandler?(c.propagate.wishItem=function(a,b){switch(a){case"remove":d.find("[data-id="+b.id+"]").removeClass(d.settings.addClass).addClass(d.settings.removeClass);break;case"add":d.find("[data-id="+b.id+"]").addClass(d.settings.addClass).removeClass(d.settings.removeClass);break;case"reset":d.find("."+e.triggerClass).addClass(d.settings.addClass).removeClass(d.settings.removeClass)}},this.each(function(){a(this).data("wishList",c),"undefined"!=typeof c.data.get(a(this).find("."+e.triggerClass).data("id"))&&a(this).find("."+e.triggerClass).removeClass(e.addClass).addClass(e.removeClass),a(this).on(e.triggerEvent+".wish","."+e.triggerClass,function(b){b.preventDefault();var f=d.picker(a(this));a(this).hasClass(e.addClass)?(c.addToWish(f),e.addClass&&a(this).removeClass(e.addClass).addClass(e.removeClass)):(c.removeToWish(f.id),e.addClass&&a(this).removeClass(e.removeClass).addClass(e.addClass))})})):unsetAttHandler()},a.fn.wishBar=function(b,c){var d=this,e=this.settings=a.extend({template:"<div rel='"+c.ID+"' id='wishItem_<%- id %>' class='wishedItem' data-id='<%- id %>'><img src='<%- img %>'><p><%- title %></p></div>",addItemHtml:null,removeItemHtml:null},b);return this.itemList="function"==typeof e.addItemHtml?e.addItemHtml:function(a){var b=_.template(e.template),c=b(a);d.append(c)},this.removeItem="function"==typeof e.removeItemHtml?e.removeItemHtml:function(b){return"undefined"==typeof b?(a("*[rel="+c.ID+"]").fadeOut().remove(),void 0):(a("#wishItem_"+b).fadeOut().remove(),void 0)},c.propagate.wishBar=function(a,b){switch(a){case"remove":d.removeItem(b.id);break;case"add":d.itemList(b);break;case"reset":d.removeItem()}},d.data("wishList",c),c.data.forEach(function(a){d.itemList(a.attributes)}),this},a.Wishlist=function(b,c){if("undefined"==typeof b)return!1;var d=[],e=window.wishList[b]={};window.wishList.length++;var f=e.settings=a.extend({$wishBar:a("#wishList"),$wishItem:a(".wishItem"),barOption:{},itemOption:{},counterClass:"wishCounter",clearId:"clearWish",useStorage:"undefined"==typeof localStorage?!1:!0,storegeName:b,setCookie:{name:b,expire:365,path:"/"},BackboneModel:{defaults:{id:null,title:null,url:null}},BackboneCollection:{},onClean:null,onLoad:null,onChange:null,debug:!1,text:{noStorage:"Questa funzione &egrave; utilizzabile solo se hai attivi i cookie o il LocalStorage.",add:"Aggiungi ",remove:"Rimuovi "}},c);e.ID=b,e.propagate={},e.addToWish=function(a){c="array"!=typeof a?new Array(a):a,e.data.add(a)},e.removeToWish=function(a){e.data.remove(e.data.get(a))},e.clearWish=function(){e.data.reset()},e.toGlobal=function(){window.wishList[b]=e},e.loadStorage=function(){var b=f.useStorage?e.loadLocalStorage():e.loadCookieStorage();return b&&null!=b?a.parseJSON(b):!1},e.updateStorege=function(){f.useStorage?e.wishToLocal():e.wishToCookie(),debWish()},e.cleanStorege=function(){f.useStorage?e.clearLocal():e.clearCookies(),e.toGlobal(),debWish()},e.loadLocalStorage=function(){return localStorage.getItem(f.storegeName)},e.wishToLocal=function(){localStorage.setItem(f.storegeName,JSON.stringify(e.data))},e.clearLocal=function(){localStorage.removeItem(f.storegeName)},e.loadCookieStorage=function(){return a.cookie(f.setCookie.name)},e.wishToCookie=function(){a.cookie(f.setCookie.name,JSON.stringify(e.data),{expires:f.setCookie.expire,path:f.setCookie.path})},e.clearCookies=function(){a.removeCookie(f.setCookie.name,{path:f.setCookie.path})},collectionChange=function(b,c){var h=c.attributes;switch(b){case"remove":e.updateStorege();break;case"add":e.updateStorege();break;case"reset":e.cleanStorege()}a("."+f.counterClass).text(e.data.length);for(fun in e.propagate)"function"==typeof e.propagate[fun]&&e.propagate[fun](b,h);"function"==typeof f.onChange&&f.onChange(e)},a("#"+f.clearId).on("click.triggerClear",function(a){a.preventDefault(),e.clearWish(),"function"==typeof f.onClean&&f.onClean.call(e)}),debWish=function(){f.debug?console.log("Stored elements:",e.loadStorage()):function(){}},debCookie=function(){f.debug?console.log("Collection:",e.data):function(){}},toConsole=function(a,b){f.debug?console.log(a+": ",b):function(){}},logWARN=function(){try{f.debug&&console.warn(d)}catch(a){}},f.BackboneCollection.model=Backbone.Model.extend(f.BackboneModel);var g=Backbone.Collection.extend(f.BackboneCollection),h=e.loadStorage();return e.data=new g,e.data.on("all",collectionChange,e),h&&e.data.add(h),f.$wishBar.length>0&&f.$wishBar.wishBar(f.barOption,e),f.$wishItem.length>0&&f.$wishItem.wishItem(f.itemOption,e),"function"==typeof f.onLoad&&f.onLoad.call(e),e.toGlobal(),debWish(),e},void 0)}(jQuery);