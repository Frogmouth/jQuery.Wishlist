/* 
 * Last Version 1.3.2 by Simone Luise
 * http://github.com/Frogmouth/jQuery.Wishlist/
 */

!function(a){return window.wishList={length:0},"undefined"==typeof _||"undefined"==typeof Backbone?wishlist=!1:(a.fn.wishItem=function(b,c){var d=this,e=this.settings=a.extend({removeClass:"removeToWish",addClass:"addToWish",triggerClass:"wishAction",sameButton:!0,triggerEvent:"click",picker:null,onRemove:null,onAdd:null,onClean:null},b),f=e.picker||function(a){var b=c.settings.useStorage?a.data():{id:a.data("id")};return b},g=function(){d.addClass("wishDisabled"),d.on("click",function(){console.log("COOKIE DISABLED")})},h=e.onClean||function(){d.find("."+e.triggerClass).addClass(d.settings.addClass).removeClass(d.settings.removeClass)},i=e.onAdd||function(a){d.find("[data-id="+a.id+"]").addClass(d.settings.addClass).removeClass(d.settings.removeClass)},j=e.onRemove||function(a){d.find("[data-id="+a.id+"]").removeClass(d.settings.addClass).addClass(d.settings.removeClass)};return e.useStorage?(localStorage.wishlist={},setHandler=!0):setHandler=navigator.cookieEnabled?!0:!1,setHandler?(c.propagate.wishItem=function(a,b){switch(a){case"remove":j(b);break;case"add":i(b);break;case"reset":h()}},this.each(function(){a(this).data("wishList",c),"undefined"!=typeof c.data.get(a(this).find("."+e.triggerClass).data("id"))&&a(this).find("."+e.triggerClass).removeClass(e.addClass).addClass(e.removeClass),a(this).on(e.triggerEvent+".wish","."+e.triggerClass,function(b){b.preventDefault();var d=f(a(this));a(this).hasClass(e.addClass)?(c.addToWish(d),e.addClass&&a(this).removeClass(e.addClass).addClass(e.removeClass)):(c.removeToWish(d.id),e.addClass&&a(this).removeClass(e.removeClass).addClass(e.addClass))})})):g()},a.fn.wishBar=function(b,c){var d=this,e=this.settings=a.extend({template:"<div rel='"+c.ID+"' id='wishItem_<%- id %>' class='wishedItem' data-id='<%- id %>'><img src='<%- img %>'><p><%- title %></p></div>",addItemHtml:null,removeItemHtml:null},b),f=e.addItemHtml||function(a){var b=_.template(e.template),c=b(a);d.append(c)},g=e.removeItemHtml||function(b){return"undefined"==typeof b?(a("*[rel="+c.ID+"]").fadeOut().remove(),void 0):(a("#wishItem_"+b).fadeOut().remove(),void 0)};return c.propagate.wishBar=function(a,b){switch(a){case"remove":g(b.id);break;case"add":f(b);break;case"reset":g()}},d.data("wishList",c),c.data.forEach(function(a){f(a.attributes)}),this},a.Wishlist=function(b,c){if("undefined"==typeof b)return!1;var e=window.wishList[b]={};window.wishList.length++;var f=e.settings=a.extend({$wishBar:a("#wishList"),$wishItem:a(".wishItem"),barOption:{},itemOption:{},counterClass:"wishCounter",clearId:"clearWish",useStorage:"undefined"==typeof localStorage?!1:!0,storeID:"undefined"==typeof localStorage?!1:!0,storegeName:b,setCookie:{name:b,expire:365,path:"/"},BackboneModel:{defaults:{id:null,title:null,url:null}},BackboneCollection:{},onClean:null,onLoad:null,onChange:null,text:{noStorage:"Wishlist needs cookie enabled.",add:"Add ",remove:"Remove "}},c);e.ID=b,e.propagate={},e.addToWish=function(a){c="array"!=typeof a?new Array(a):a,e.data.add(a)},e.removeToWish=function(a){e.data.remove(e.data.get(a))},e.clearWish=function(){e.data.reset()},e.toGlobal=function(){window.wishList[b]=e},e.loadStorage=function(){var b=f.useStorage?g():k();return b&&null!=b?a.parseJSON(b):!1},e.updateStorege=function(){f.useStorage?h():l()},e.cleanStorege=function(){f.useStorage?i():m(),e.toGlobal()};var g=function(){return localStorage.getItem(f.storegeName)},h=function(){localStorage.setItem(f.storegeName,JSON.stringify(e.data)),f.storeID&&j()},i=function(){localStorage.removeItem(f.storegeName),f.storeID&&j()},j=function(){var b=[];e.data.each(function(a){b.push(a.id)}),a.cookie(f.setCookie.name+"_IDS",JSON.stringify(b)),console.log(a.cookie(f.setCookie.name+"_IDS"))},k=function(){return a.cookie(f.setCookie.name)},l=function(){a.cookie(f.setCookie.name,JSON.stringify(e.data),{expires:f.setCookie.expire,path:f.setCookie.path})},m=function(){a.removeCookie(f.setCookie.name,{path:f.setCookie.path})},n=function(b,c,d){var h=c.attributes;switch(b){case"remove":e.updateStorege();break;case"add":e.updateStorege();break;case"reset":e.cleanStorege()}a("."+f.counterClass).text(e.data.length);for(fun in e.propagate)"function"==typeof e.propagate[fun]&&e.propagate[fun](b,h);"function"==typeof f.onChange&&f.onChange.call(e,b,c,d)};a("#"+f.clearId).on("click.triggerClear",function(a){a.preventDefault(),e.clearWish(),"function"==typeof f.onClean&&f.onClean.call(e)}),f.BackboneCollection.model=Backbone.Model.extend(f.BackboneModel);var o=Backbone.Collection.extend(f.BackboneCollection),p=e.loadStorage();return e.data=new o,e.data.on("all",n,e),p&&e.data.add(p),f.$wishBar.length>0&&f.$wishBar.wishBar(f.barOption,e),f.$wishItem.length>0&&f.$wishItem.wishItem(f.itemOption,e),"function"==typeof f.onLoad&&f.onLoad.call(e),e.toGlobal(),e},void 0)}(jQuery);